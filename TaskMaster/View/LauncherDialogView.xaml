<!--
 This file is part of TaskMaster.
 Copyright (C) 2025 Aaron Semler

 TaskMaster is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<UserControl x:Class="TaskMaster.View.LauncherDialogView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:TaskMaster.ViewModel"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:LauncherDialogViewModel, IsDesignTimeCreatable=True}"
             d:DesignHeight="{StaticResource Window.BaseHeight}"
             d:DesignWidth="{StaticResource Window.BaseWidth}"
             KeyboardNavigation.TabNavigation="None"
             FocusManager.IsFocusScope="True"
             Focusable="False"
             UseLayoutRounding="True"
             SnapsToDevicePixels="True">

    <Grid x:Name="LauncherDialog"
          Visibility="{Binding IsOpen, Converter={StaticResource BoolToVisibility}}">
        
        <Border Width="{StaticResource Size.LauncherDialog.Width}"
                Height="Auto"
                Padding="16"
                Background="{DynamicResource Brush.Panel.Background}"
                BorderBrush="{DynamicResource Brush.Border}"
                BorderThickness="1"
                CornerRadius="{DynamicResource CornerRadius.CurrentStyle}"
                Focusable="True"
                FocusManager.IsFocusScope="True"
                KeyboardNavigation.TabNavigation="Cycle"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Effect">
                            <Setter.Value>
                                <DropShadowEffect
                                    Color="{DynamicResource Color.Button.Shadow}" 
                                    ShadowDepth="6" 
                                    BlurRadius="5" 
                                    Direction="240" 
                                    Opacity="0.6"/>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Border.Style>
            <Grid>
                <Grid.RowDefinitions>
                    <!-- Top Target -->
                    <RowDefinition Height="Auto"/>
                    <!-- Target Name + Enabled + Save/Cancel -->
                    <RowDefinition Height="Auto"/>
                    <!-- Target Path mini Browse -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <!-- Target Params TextBox -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <!-- Auxiliary sub-section -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="{StaticResource Grid.ListRegion.Height.Aux}"/>
                    <!-- Selected Aux App TextBox + Browse -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <!-- Selected Aux Params TextBox -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Target Application Name (plus controls) -->
                <Grid Grid.Row="1" Margin="0,4,0,8">
                    <!-- Enabled + Save/Cancel, "*" for column 1 and 3 as spacers -->
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Row="0" Margin="2,-8,0,0" VerticalAlignment="Top"
                               Style="{StaticResource TextBlock.SubTitle}"
                               Text="{DynamicResource Text.LauncherDialog.Target.Name}"/>
                    <TextBox x:Name="TargetAppName" Margin="2,0,0,8" VerticalAlignment="Bottom" IsReadOnly="True"
                             Style="{StaticResource TextBox.Medium}"
                             Text="{Binding Editing.Entry.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    <StackPanel Grid.Column="2">
                        <CheckBox x:Name="TargetLauncher"
                                  Style="{StaticResource CheckBox.Checked}"
                                  Content="{DynamicResource Text.LauncherDialog.CheckBox.Enabled}"
                                  ToolTip="{DynamicResource ToolTip.LauncherDialog.CheckBox.Enabled}"
                                  IsChecked="{Binding Editing.Entry.Enabled, Mode=TwoWay}"
                                  Checked="TargetEnabled_Checked"
                                  Unchecked="TargetEnabled_UnChecked"/>
                        <CheckBox x:Name="TargetDetector"
                                  Style="{StaticResource CheckBox.Checked}"
                                  Content="{DynamicResource Text.LauncherDialog.CheckBox.Detector}"
                                  ToolTip="{DynamicResource ToolTip.LauncherDialog.CheckBox.Detector}"
                                  IsChecked="{Binding Editing.Entry.Detection, Mode=TwoWay}"
                                  Checked="TargetDetector_Checked"
                                  Unchecked="TargetDetector_UnChecked"/>
                    </StackPanel>
                    <Button Grid.Column="4" Margin="8,0,0,0" VerticalAlignment="Center"
                            Style="{StaticResource Button.Narrow}"
                            Content="{DynamicResource Text.Button.Save}" Command="{Binding SaveCommand}"/>
                    <Button Grid.Column="5" Margin="8,0,0,0" VerticalAlignment="Center"
                            Style="{StaticResource Button.Narrow}"
                            Content="{DynamicResource Text.Button.Cancel}" Command="{Binding CancelCommand}"/>
                </Grid>

                <!-- Target Application Path -->
                <TextBlock Grid.Row="2" Margin="2,0,0,2"
                           Style="{StaticResource TextBlock.SubTitle}"
                           Text="{DynamicResource Text.LauncherDialog.Target.Path}"/>
                <Grid Grid.Row="3" Margin="0,4,0,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" IsReadOnly="True"
                             Style="{StaticResource TextBox.Wide}"
                             Text="{Binding Editing.Entry.Path, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Grid.Column="1" Margin="6,0,0,0"
                            Style="{StaticResource Button.Fat}"
                            Content="..." Command="{Binding BrowsePathCommand}"/>
                </Grid>

                <!-- Target App Launch Parameters -->
                <TextBlock Grid.Row="4" Margin="2,8,0,2"
                           Style="{StaticResource TextBlock.SubTitle}"
                           Text="{DynamicResource Text.LauncherDialog.Target.Args}"/>
                <TextBox Grid.Row="5" Margin="0,0,0,8" Style="{StaticResource TextBox.Full}"
                         Text="{Binding Editing.Entry.Arguments, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="{DynamicResource ToolTip.LauncherDialog.Target.Args}"/>

                <!-- Auxiliary Section Title -->
                <Grid Grid.Row="6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Margin="2,12,0,8"
                               Style="{StaticResource TextBlock.SubTitle}"
                               Text="{DynamicResource Text.LauncherDialog.Aux.SavedItems}"/>
                    <CheckBox Grid.Column="1" Margin="29,0,0,8"
                              Style="{StaticResource CheckBox.Checked}" 
                              Content="{DynamicResource Text.LauncherDialog.CheckBox.EnabledAux}"
                              ToolTip="{DynamicResource ToolTip.LauncherDialog.CheckBox.EnabledAux}"
                              IsChecked="{Binding Editing.Entry.AuxEnabled, Mode=TwoWay}"/>
                    <TextBlock Grid.Column="3" Margin="0,8,12,4" HorizontalAlignment="Right"
                               Style="{StaticResource TextBlock.SubTitle}"
                               Text="{DynamicResource Text.RunningProcesses}"/>
                </Grid>

                <!-- Aux two listboxes with buttons -->
                <Grid Grid.Row="7" Margin="0,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="{StaticResource Grid.ButtonStack.Width.Aux}"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Saved aux (left) -->
                    <ListBox Grid.Column="0" Margin="0,0,8,0"
                             Style="{StaticResource ListBox.Left.Aux}"
                             ItemsSource="{Binding Editing.AuxApps}"
                             DisplayMemberPath="Name"
                             SelectedItem="{Binding Editing.SelectedAuxApp, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    
                    <!-- Aux Buttons -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Button Margin="0,4,0,4" Style="{StaticResource Button.Narrow}"
                                Content="{DynamicResource Text.Button.Add}" Command="{Binding AuxAddFromRunningCommand}"/>
                        <Button Margin="0,4,0,4" Style="{StaticResource Button.Narrow}"
                                Content="{DynamicResource Text.Button.Browse}" Command="{Binding AuxBrowseCommand}"/>
                        <Separator Margin="0,2,0,2"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="{StaticResource Grid.ButtonStack.Width.Spacer}"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0" Margin="2,2,1,2" Style="{StaticResource Button.Square}"
                                    Content="↑" Command="{Binding AuxMoveUpCommand}"/>
                            <Button Grid.Column="2" Margin="0,2,0,2" Style="{StaticResource Button.Square}"
                                    Content="↓" Command="{Binding AuxMoveDownCommand}"/>
                        </Grid>
                        <Button Margin="0,4,0,4" Style="{StaticResource Button.Narrow}"
                                Content="{DynamicResource Text.Button.Remove}" Command="{Binding AuxRemoveCommand}"/>
                    </StackPanel>

                    <!-- Running processes (right) -->
                    <ListBox Grid.Column="2" Margin="8,0,0,0"
                             Style="{StaticResource ListBox.Right.Aux}"
                             ItemsSource="{Binding DataContext.Running.Items, RelativeSource={RelativeSource AncestorType=Window}}"
                             DisplayMemberPath="Name"
                             SelectedValuePath="Name"
                             SelectedValue="{Binding SelectedRunning, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </Grid>

                <!-- Aux Application Path -->
                <TextBlock Grid.Row="8" Margin="2,4,0,2"
                           Style="{StaticResource TextBlock.SubTitle}"
                           Text="{DynamicResource Text.LauncherDialog.Aux.Path}"/>
                <Grid Grid.Row="9" Margin="0,0,0,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" IsReadOnly="True"
                             Style="{StaticResource TextBox.Wide}"
                             Text="{Binding Editing.SelectedAuxApp.Path, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Grid.Column="1" Margin="6,0,0,0"
                            Style="{StaticResource Button.Fat}"
                            Content="..." Command="{Binding AuxBrowsePathCommand}"/>
                </Grid>

                <!-- Aux Launch Parameters -->
                <TextBlock Grid.Row="10" Margin="2,4,0,2"
                           Style="{StaticResource TextBlock.SubTitle}"
                           Text="{DynamicResource Text.LauncherDialog.Aux.Args}"/>
                <TextBox Grid.Row="11" Style="{StaticResource TextBox.Full}"
                         Text="{Binding Editing.SelectedAuxApp.Arguments, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="{DynamicResource ToolTip.LauncherDialog.Aux.Args}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
