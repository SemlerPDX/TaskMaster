<!--
 This file is part of TaskMaster.
 Copyright (C) 2025 Aaron Semler

 TaskMaster is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.   
-->
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:primitives="clr-namespace:System.Windows.Controls.Primitives;assembly=PresentationFramework">

    <!-- Base ListBox with custom ScrollBar -->
    <Style TargetType="ListBox">
        <Setter Property="Background" Value="{DynamicResource Brush.ListBox.Background}"/>
        <Setter Property="Foreground" Value="{DynamicResource Brush.Text}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource Brush.Border}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Margin" Value="0"/>
        <Setter Property="SelectionMode" Value="Single"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="ToolTipService.InitialShowDelay" Value="1500"/>
        <Setter Property="ToolTipService.ShowDuration" Value="5000"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ListBox}">
                    <Border x:Name="Outer"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{DynamicResource CornerRadius.CurrentStyle}"
                            SnapsToDevicePixels="True">

                        <!-- Layout container for a dedicated mask element -->
                        <Grid>
                            <!-- Opaque Mask Shape -->
                            <Border x:Name="MaskShape"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="{DynamicResource CornerRadius.CurrentStyle}"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"/>

                            <!-- Content host with OpacityMask -->
                            <Grid>
                                <Grid.OpacityMask>
                                    <VisualBrush Visual="{Binding ElementName=MaskShape}"/>
                                </Grid.OpacityMask>

                                <ScrollViewer Focusable="False"
                                              Padding="{TemplateBinding Padding}">
                                    <ItemsPresenter/>
                                </ScrollViewer>
                            </Grid>
                        </Grid>
                    </Border>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Outer" Property="Opacity" Value="0.6"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>

            </Setter.Value>
        </Setter>

        <!-- Custom Vertical Scrollbar Style -->
        <Style.Resources>
            <Style TargetType="ScrollBar">
                <Setter Property="Width" Value="12"/>
                <Setter Property="Background" Value="{DynamicResource Brush.ScrollBar.Background}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ScrollBar">
                            <Grid SnapsToDevicePixels="True"
                                  Background="{TemplateBinding Background}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Up Arrow Button -->
                                <RepeatButton Grid.Row="0"
                                              Command="ScrollBar.LineUpCommand"
                                              Focusable="False">
                                    <RepeatButton.Template>
                                        <ControlTemplate TargetType="RepeatButton">
                                            <Grid x:Name="Bg" Background="{DynamicResource Brush.ScrollBar.Button.Background}">
                                                <Path x:Name="Arrow"
                                                      Data="M 6,9 L 10,5 L 14,9 Z"
                                                      Width="10" Height="10" Stretch="Uniform"
                                                      Fill="{DynamicResource Brush.ScrollBar.Arrow}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background"
                                                            Value="{DynamicResource Brush.ScrollBar.Button.Background.Hover}"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="Bg" Property="Background"
                                                            Value="{DynamicResource Brush.ScrollBar.Button.Background.Pressed}"/>
                                                    <Setter TargetName="Arrow" Property="Fill"
                                                            Value="{DynamicResource Brush.ScrollBar.Arrow.Pressed}"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </RepeatButton.Template>
                                </RepeatButton>

                                <!-- Track (page regions + thumb) -->
                                <Grid Grid.Row="1">
                                    <Border Background="{DynamicResource Brush.ScrollBar.Track}"
                                            CornerRadius="{DynamicResource CornerRadius.CurrentStyle}"
                                            Margin="3,2"/>
                                    <Track x:Name="PART_Track" IsDirectionReversed="True" Margin="3,2">
                                        <Track.DecreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageUpCommand"
                                                          Focusable="False">
                                                <RepeatButton.Template>
                                                    <ControlTemplate TargetType="RepeatButton">
                                                        <Rectangle Fill="Transparent"/>
                                                    </ControlTemplate>
                                                </RepeatButton.Template>
                                            </RepeatButton>
                                        </Track.DecreaseRepeatButton>

                                        <Track.Thumb>
                                            <Thumb>
                                                <Thumb.Template>
                                                    <ControlTemplate TargetType="Thumb">
                                                        <Border x:Name="ThumbBd"
                                                                CornerRadius="{DynamicResource CornerRadius.CurrentStyle}"
                                                                Background="{DynamicResource Brush.ScrollBar.Thumb}"
                                                                SnapsToDevicePixels="True"/>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="ThumbBd" Property="Background"
                                                                        Value="{DynamicResource Brush.ScrollBar.Thumb.Hover}"/>
                                                            </Trigger>
                                                            <Trigger Property="IsDragging" Value="True">
                                                                <Setter TargetName="ThumbBd" Property="Background"
                                                                        Value="{DynamicResource Brush.ScrollBar.Thumb.Pressed}"/>
                                                            </Trigger>
                                                            <Trigger Property="IsEnabled" Value="False">
                                                                <Setter TargetName="ThumbBd" Property="Opacity" Value="0.5"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Thumb.Template>
                                            </Thumb>
                                        </Track.Thumb>

                                        <Track.IncreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageDownCommand"
                                                          Focusable="False">
                                                <RepeatButton.Template>
                                                    <ControlTemplate TargetType="RepeatButton">
                                                        <Rectangle Fill="Transparent"/>
                                                    </ControlTemplate>
                                                </RepeatButton.Template>
                                            </RepeatButton>
                                        </Track.IncreaseRepeatButton>
                                    </Track>
                                </Grid>

                                <!-- Down Arrow Button -->
                                <RepeatButton Grid.Row="2"
                                              Command="ScrollBar.LineDownCommand"
                                              Focusable="False">
                                    <RepeatButton.Template>
                                        <ControlTemplate TargetType="RepeatButton">
                                            <Grid x:Name="Bg" Background="{DynamicResource Brush.ScrollBar.Button.Background}">
                                                <Path x:Name="Arrow"
                                                      Data="M 6,5 L 14,5 L 10,9 Z"
                                                      Width="10" Height="10" Stretch="Uniform"
                                                      Fill="{DynamicResource Brush.ScrollBar.Arrow}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background"
                                                            Value="{DynamicResource Brush.ScrollBar.Button.Background.Hover}"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="Bg" Property="Background"
                                                            Value="{DynamicResource Brush.ScrollBar.Button.Background.Pressed}"/>
                                                    <Setter TargetName="Arrow" Property="Fill"
                                                            Value="{DynamicResource Brush.ScrollBar.Arrow.Pressed}"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </RepeatButton.Template>
                                </RepeatButton>

                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Style.Resources>
    </Style>

    <!-- Base ListBoxItem Style -->
    <Style TargetType="{x:Type ListBoxItem}">
        <Setter Property="FocusVisualStyle" Value="{StaticResource Focus.Transparent}"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="Padding" Value="2,4"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderBrush" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="HorizontalContentAlignment"
                Value="{Binding RelativeSource={RelativeSource AncestorType=ItemsControl},
                                Path=HorizontalContentAlignment}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                    <Border x:Name="Bd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{DynamicResource CornerRadius.CurrentStyle}"
                            Padding="10,1"
                            SnapsToDevicePixels="True">
                        <ContentPresenter
                            Margin="0"
                            VerticalAlignment="Center"
                            RecognizesAccessKey="True"/>
                    </Border>

                    <ControlTemplate.Triggers>
                        <!-- Hover -->
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bd" Property="BorderBrush"
                                    Value="{DynamicResource Brush.ListItem.Border.Hover}"/>
                        </Trigger>

                        <!-- Selected + ACTIVE (list has focus) -->
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Bd" Property="Background"
                                    Value="{DynamicResource Brush.ListItem.Selected.Background}"/>
                            <Setter TargetName="Bd" Property="BorderBrush"
                                    Value="{DynamicResource Brush.ListItem.Selected.Border}"/>
                            <Setter Property="Foreground"
                                    Value="{DynamicResource Brush.ListItem.Selected.Text}"/>
                        </Trigger>

                        <!-- Selected but INACTIVE (list lost focus) -->
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="True"/>
                                <Condition Property="primitives:Selector.IsSelectionActive" Value="False"/>
                            </MultiTrigger.Conditions>
                            <Setter TargetName="Bd" Property="Background"
                                    Value="{DynamicResource Brush.ListItem.SelectedInactive.Background}"/>
                            <Setter TargetName="Bd" Property="BorderBrush"
                                    Value="{DynamicResource Brush.ListItem.SelectedInactive.Border}"/>
                            <Setter Property="Foreground"
                                    Value="{DynamicResource Brush.ListItem.SelectedInactive.Text}"/>
                        </MultiTrigger>

                        <!-- Disabled -->
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Selected Tasks variant -->
    <Style x:Key="ListBox.Left" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="Margin" Value="0,0,8,0"/>
        <Setter Property="MaxWidth" Value="{StaticResource Size.ListBox.MaxWidth}"/>
        <Setter Property="Height" Value="{StaticResource Size.ListRegion.Height}"/>
        <Setter Property="ToolTip" Value="{DynamicResource ToolTip.App.ListBox.SavedTask}"/>
    </Style>
    <!-- Selected Aux Tasks variant -->
    <Style x:Key="ListBox.Left.Aux" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="Margin" Value="0,0,8,0"/>
        <Setter Property="MaxWidth" Value="{StaticResource Size.ListBox.MaxWidth}"/>
        <Setter Property="Height" Value="{StaticResource Size.ListRegion.Height.Aux}"/>
        <Setter Property="ToolTip" Value="{DynamicResource ToolTip.App.ListBox.SavedTask}"/>
    </Style>

    <!-- Running Tasks variant (right) -->
    <Style x:Key="ListBox.Right" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="Margin" Value="8,0,0,0"/>
        <Setter Property="MaxWidth" Value="{StaticResource Size.ListBox.MaxWidth}"/>
        <Setter Property="Height" Value="{StaticResource Size.ListRegion.Height}"/>
        <Setter Property="ToolTip" Value="{DynamicResource ToolTip.App.ListBox.RunningProcess}"/>
    </Style>
    <!-- Running Aux Tasks variant (right) -->
    <Style x:Key="ListBox.Right.Aux" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="Margin" Value="8,0,0,0"/>
        <Setter Property="MaxWidth" Value="{StaticResource Size.ListBox.MaxWidth}"/>
        <Setter Property="Height" Value="{StaticResource Size.ListRegion.Height.Aux}"/>
        <Setter Property="ToolTip" Value="{DynamicResource ToolTip.App.ListBox.RunningProcess}"/>
    </Style>

    <!-- History variant (no selection chrome, smaller line height) -->
    <Style x:Key="ListBox.Wide" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="Margin" Value="8,0,8,0"/>
        <Setter Property="MaxWidth" Value="{StaticResource Size.ListBox.MaxWidth.History}"/>
        <Setter Property="MaxHeight" Value="{StaticResource Size.ListBox.MaxHeight.History}"/>
        <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True"/>
        <Setter Property="VirtualizingStackPanel.VirtualizationMode" Value="Recycling"/>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Focusable" Value="False"/>
                    <Setter Property="Padding" Value="9,0,0,0"/>
                    <Setter Property="Background" Value="{x:Null}"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Dim}"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListBoxItem">
                                <ContentPresenter Margin="{TemplateBinding Padding}"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
    </Style>
    
    <!-- License variant (no selection chrome, smaller line height) -->
    <Style x:Key="ListBox.License" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="Margin" Value="8,0,8,0"/>
        <Setter Property="Width" Value="{StaticResource Size.ListBox.MaxWidth.License}"/>
        <Setter Property="Height" Value="{StaticResource Size.ListBox.MaxHeight.License}"/>
        <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True"/>
        <Setter Property="VirtualizingStackPanel.VirtualizationMode" Value="Recycling"/>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Focusable" Value="False"/>
                    <Setter Property="Padding" Value="2,0,0,0"/>
                    <Setter Property="Background" Value="{x:Null}"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Dim}"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListBoxItem">
                                <ContentPresenter Margin="{TemplateBinding Padding}"/>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>